---
// Reading progress bar that shows scroll position through an article
---

<div class="reading-progress-container">
    <div class="reading-progress-bar" id="reading-progress"></div>
</div>

<style>
    .reading-progress-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: transparent;
        z-index: 50;
    }

    .reading-progress-bar {
        height: 100%;
        width: 0%;
        background: rgb(var(--color-text-main) / 0.7);
        transition: width 50ms ease-out;
    }
</style>

<script>
    document.addEventListener("astro:page-load", () => {
        const progressBar = document.getElementById("reading-progress");
        if (!progressBar) return;

        const article = document.querySelector("article");
        if (!article) {
            progressBar.style.width = "0%";
            return;
        }

        function updateProgress() {
            const articleRect = article!.getBoundingClientRect();
            const articleTop = articleRect.top + window.scrollY;
            const articleHeight = articleRect.height;
            const windowHeight = window.innerHeight;
            const scrollY = window.scrollY;

            // Calculate how far through the article we've scrolled
            const start = articleTop;
            const end = articleTop + articleHeight - windowHeight;
            const current = scrollY;

            let progress = 0;
            if (current >= start && current <= end) {
                progress = ((current - start) / (end - start)) * 100;
            } else if (current > end) {
                progress = 100;
            }

            progressBar!.style.width = `${Math.min(100, Math.max(0, progress))}%`;
        }

        window.addEventListener("scroll", updateProgress, { passive: true });
        window.addEventListener("resize", updateProgress, { passive: true });
        updateProgress();
    });
</script>
